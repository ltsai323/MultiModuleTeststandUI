<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8">
  <head>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <title>Multimodule Teststand UI</title>
    <script>
      function confirmSelection() {
        const selected = document.querySelector('input[name="option"]:checked');
        if (!selected) { alert("Please select an option."); return; }

        let iframeUrl;
        // blueprint name + function name in blueprint
        if (selected.value === "task1") { iframeUrl = "{{ url_for('app_task1.main') }}"; }
        else if (selected.value === "task2") { iframeUrl = "{{ url_for('app_task2.main') }}"; }
        else if (selected.value === "task3") { iframeUrl = "{{ url_for('app_task3.main') }}"; }
        const iframe = document.getElementById("myIframe");
        iframe.src = iframeUrl;

        iframe.onload = function() {
          try {
            iframe.style.height = iframe.contentDocument.body.scrollHeight + 'px';
          } catch(e) { 
            console.warn('Cannot get height, use default 400px');
            iframe.style.height = '400px';
          }
        }

        // nofity server for optioin update.
        fetch("/set_option",
          {
            method: "POST",
            headers: {
		"Content-Type": "application/json",
		"X-CSRFToken": document.querySelector('meta[name="csrf-token"]').content
	    },
            body: JSON.stringify({ option: selected.value })
          });
      }
    </script>
    <script>
    function adjustIframeHeight() {
        const iframe = document.getElementById('myIframe');
        if (iframe.contentWindow) {
            // Get the height of the body of the iframe's document
            const body = iframe.contentWindow.document.body;
            const height = body.scrollHeight;
    
            // Set the height of the iframe
            iframe.style.height = height + 'px';
	    iframe.style.border = 0;
            console.log("modify iframe height as " + height + "px");
        }
    }
    </script>
  </head>
  <body>
    <div class='container-width'>
      <h1>Select a job</h1>

      <form id="optionsForm">
        <label> <input type="radio" name="option" value="task1" {% if selected_option == 'task1' %} checked {% endif %}> Single Pedestal Run </label>
        <label> <input type="radio" name="option" value="task2" {% if selected_option == 'task2' %} checked {% endif %}> test region </label>
        <label> <input type="radio" name="option" value="task3" {% if selected_option == 'task3' %} checked {% endif %}> IV scan </label>
        <button type="button" onclick="confirmSelection()">Confirm</button>
      </form>

      <iframe id="myIframe" width="100%" onload="adjustIframeHeight()"
                                           src="{% if selected_option == 'task1' %}{{ url_for('app_task1.main') }}{% elif selected_option == 'task2' %}{{ url_for('app_task2.main') }}{% elif selected_option == 'task3' %}{{ url_for('app_task3.main') }}{% endif %}"></iframe>
    </div>
  </body>
</html>
<style>
  .container-width{
    width: 1200px;
    height: 100%;
    margin:0 auto 0 auto;
  }
</style>


